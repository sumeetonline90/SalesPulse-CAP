sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,s,t)=>{"use strict";return e.extend("com.sap.salespulse.salespulseui.controller.Main",{onInit(){this.getView().setModel(new t,"viewModel")},onFileChange(e){const t=this.byId("fileUploader");const o=t.getDomRef();const l=o.querySelector('input[type="file"]');const r=this.byId("uploadButton");if(l&&l.files&&l.files.length>0){const e=l.files[0];r.setEnabled(true);s.show("File selected: "+e.name)}else{r.setEnabled(false)}},async onUpload(){const e=this.byId("fileUploader");const t=e.getDomRef();const o=t.querySelector('input[type="file"]');if(!o||!o.files||o.files.length===0){s.show("Please select a file first");return}const l=o.files[0];if(!l.name.toLowerCase().endsWith(".xlsx")){s.show("Please select an Excel file (.xlsx)");return}s.show("Uploading file...");try{const t=this.getView().getModel();if(!t){throw new Error("OData model not found")}const o=await this.readFileAsBase64(l);const r=t.bindContext("/uploadExcel(...)",t);r.setParameter("excel",o);const n=await new Promise((e,s)=>{r.execute().then(s=>{e(s)}).catch(e=>{s(e)})});const a=n.value||n||"File uploaded successfully!";s.show(a);this.onRefresh();e.clear();this.byId("uploadButton").setEnabled(false)}catch(e){console.error("Upload error:",e);s.show("Upload failed: "+e.message)}},readFileAsBase64(e){return new Promise((s,t)=>{const o=new FileReader;o.onload=e=>{try{const t=e.target.result.split(",")[1];s(t)}catch(e){t(new Error("Error processing file: "+e.message))}};o.onerror=()=>{t(new Error("Error reading file"))};o.readAsDataURL(e)})},onUploadComplete(e){const t=e.getParameter("response");if(t){s.show("Upload completed: "+t);this.onRefresh()}},onTypeMissmatch(e){s.show("Please select an Excel file (.xlsx)")},onRefresh(){const e=this.byId("salesTable");const t=e.getBinding("items");if(t){t.refresh();s.show("Data refreshed")}else{const e=this.getView().getModel();if(e){e.refresh(true);s.show("Model refreshed")}}}})});
//# sourceMappingURL=Main.controller.js.map