sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel"],(e,s,t)=>{"use strict";return e.extend("com.sap.salespulse.salespulseui.controller.Main",{onInit(){this.getView().setModel(new t,"viewModel")},onFileChange(e){const t=this.byId("fileUploader");const o=t.getDomRef();const l=o.querySelector('input[type="file"]');const n=this.byId("uploadButton");if(l&&l.files&&l.files.length>0){const e=l.files[0];n.setEnabled(true);s.show("File selected: "+e.name)}else{n.setEnabled(false)}},async onUpload(){const e=this.byId("fileUploader");const t=e.getDomRef();const o=t.querySelector('input[type="file"]');if(!o||!o.files||o.files.length===0){s.show("Please select a file first");return}const l=o.files[0];if(!l.name.toLowerCase().endsWith(".xlsx")){s.show("Please select an Excel file (.xlsx)");return}s.show("Uploading file...");try{const t=await this.readFileAsBase64(l);const o=await fetch("/sales-service/uploadExcel",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({excel:t})});if(!o.ok){throw new Error(`HTTP ${o.status}: ${o.statusText}`)}const n=await o.json();const r=n.value||n||"File uploaded successfully!";s.show(r);this.onRefresh();e.clear();this.byId("uploadButton").setEnabled(false)}catch(e){console.error("Upload error:",e);s.show("Upload failed: "+e.message)}},readFileAsBase64(e){return new Promise((s,t)=>{const o=new FileReader;o.onload=e=>{try{const t=e.target.result.split(",")[1];s(t)}catch(e){t(new Error("Error processing file: "+e.message))}};o.onerror=()=>{t(new Error("Error reading file"))};o.readAsDataURL(e)})},onUploadComplete(e){const t=e.getParameter("response");if(t){s.show("Upload completed: "+t);this.onRefresh()}},onTypeMissmatch(e){s.show("Please select an Excel file (.xlsx)")},onRefresh(){const e=this.byId("salesTable");const t=e.getBinding("items");if(t){t.refresh();s.show("Data refreshed")}else{const e=this.getView().getModel();if(e){e.refresh(true);s.show("Model refreshed")}}}})});
//# sourceMappingURL=Main.controller.js.map